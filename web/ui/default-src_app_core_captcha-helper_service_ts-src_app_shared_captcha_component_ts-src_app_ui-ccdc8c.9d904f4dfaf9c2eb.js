"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([["default-src_app_core_captcha-helper_service_ts-src_app_shared_captcha_component_ts-src_app_ui-ccdc8c"],{76:(T,O,n)=>{n.d(O,{z:()=>c});var c=(()=>{return(P=c||(c={})).INTERNAL="internal",P.RECAPTCHA_V_2="recaptchaV2",c;var P})()},3868:(T,O,n)=>{n.d(O,{T:()=>C});var c=n(520),P=n(1352),e=n(8637),A=n(2198),t=n(4850),E=n(6435),f=n(297);let C=(()=>{class l extends P.b{constructor(s,u){super(s,u)}listPendingAgreements$Response(s,u){const i=new e.c(this.rootUrl,l.ListPendingAgreementsPath,"get");return s&&i.query("fields",s.fields,{explode:!1}),this.http.request(i.build({responseType:"json",accept:"application/json",context:u})).pipe((0,A.h)(o=>o instanceof c.Zn),(0,t.U)(o=>o))}listPendingAgreements(s,u){return this.listPendingAgreements$Response(s,u).pipe((0,t.U)(i=>i.body))}acceptPendingAgreement$Response(s,u){const i=new e.c(this.rootUrl,l.AcceptPendingAgreementPath,"post");return s&&i.query("agreements",s.agreements,{}),this.http.request(i.build({responseType:"text",accept:"*/*",context:u})).pipe((0,A.h)(o=>o instanceof c.Zn),(0,t.U)(o=>o.clone({body:void 0})))}acceptPendingAgreement(s,u){return this.acceptPendingAgreement$Response(s,u).pipe((0,t.U)(i=>i.body))}acceptOptionalAgreements$Response(s,u){const i=new e.c(this.rootUrl,l.AcceptOptionalAgreementsPath,"post");return s&&i.query("agreements",s.agreements,{}),this.http.request(i.build({responseType:"text",accept:"*/*",context:u})).pipe((0,A.h)(o=>o instanceof c.Zn),(0,t.U)(o=>o.clone({body:void 0})))}acceptOptionalAgreements(s,u){return this.acceptOptionalAgreements$Response(s,u).pipe((0,t.U)(i=>i.body))}getAgreementContent$Response(s,u){const i=new e.c(this.rootUrl,l.GetAgreementContentPath,"get");return s&&(i.path("key",s.key,{}),i.query("fields",s.fields,{explode:!1}),i.query("version",s.version,{})),this.http.request(i.build({responseType:"json",accept:"application/json",context:u})).pipe((0,A.h)(o=>o instanceof c.Zn),(0,t.U)(o=>o))}getAgreementContent(s,u){return this.getAgreementContent$Response(s,u).pipe((0,t.U)(i=>i.body))}getUserAgreements$Response(s,u){const i=new e.c(this.rootUrl,l.GetUserAgreementsPath,"get");return s&&(i.path("user",s.user,{}),i.query("fields",s.fields,{explode:!1})),this.http.request(i.build({responseType:"json",accept:"application/json",context:u})).pipe((0,A.h)(o=>o instanceof c.Zn),(0,t.U)(o=>o))}getUserAgreements(s,u){return this.getUserAgreements$Response(s,u).pipe((0,t.U)(i=>i.body))}}return l.ListPendingAgreementsPath="/agreements/pending",l.AcceptPendingAgreementPath="/agreements/accept",l.AcceptOptionalAgreementsPath="/agreements/optional",l.GetAgreementContentPath="/agreements/{key}/content",l.GetUserAgreementsPath="/{user}/agreements",l.\u0275fac=function(s){return new(s||l)(E.LFG(f.p),E.LFG(c.eN))},l.\u0275prov=E.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},8089:(T,O,n)=>{n.d(O,{D:()=>A});var c=n(3075),P=n(76),e=n(6435);let A=(()=>{class t{constructor(f){this.formBuilder=f}captchaUsesChallenge(f){return"object"==typeof f&&(f=f.provider),f===P.z.INTERNAL}captchaFormGroup(f){if(!f)return null;const C=this.formBuilder.group({response:["",c.kI.required]});return this.captchaUsesChallenge(f)&&C.addControl("challenge",new c.NI("",c.kI.required)),C}}return t.\u0275fac=function(f){return new(f||t)(e.LFG(c.qu))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},4113:(T,O,n)=>{n.d(O,{h:()=>B});var c=n(76),P=n(7645),e=n(7545),A=n(2868),t=n(6435),E=n(520),f=n(1352),C=n(8637),l=n(2198),d=n(4850),s=n(297);let u=(()=>{class h extends f.b{constructor(r,m){super(r,m)}newCaptcha$Response(r,m){const p=new C.c(this.rootUrl,h.NewCaptchaPath,"post");return r&&(p.query("group",r.group,{}),p.query("previousChallenge",r.previousChallenge,{})),this.http.request(p.build({responseType:"text",accept:"text/plain",context:m})).pipe((0,l.h)(D=>D instanceof E.Zn),(0,d.U)(D=>D))}newCaptcha(r,m){return this.newCaptcha$Response(r,m).pipe((0,d.U)(p=>p.body))}getCaptchaContent$Response(r,m){const p=new C.c(this.rootUrl,h.GetCaptchaContentPath,"get");return r&&(p.path("id",r.id,{}),p.query("group",r.group,{}),p.query("width",r.width,{}),p.query("height",r.height,{})),this.http.request(p.build({responseType:"blob",accept:"image/*",context:m})).pipe((0,l.h)(D=>D instanceof E.Zn),(0,d.U)(D=>D))}getCaptchaContent(r,m){return this.getCaptchaContent$Response(r,m).pipe((0,d.U)(p=>p.body))}deleteCaptcha$Response(r,m){const p=new C.c(this.rootUrl,h.DeleteCaptchaPath,"delete");return r&&p.path("id",r.id,{}),this.http.request(p.build({responseType:"text",accept:"*/*",context:m})).pipe((0,l.h)(D=>D instanceof E.Zn),(0,d.U)(D=>D.clone({body:void 0})))}deleteCaptcha(r,m){return this.deleteCaptcha$Response(r,m).pipe((0,d.U)(p=>p.body))}}return h.NewCaptchaPath="/captcha",h.GetCaptchaContentPath="/captcha/{id}",h.DeleteCaptchaPath="/captcha/{id}",h.\u0275fac=function(r){return new(r||h)(t.LFG(s.p),t.LFG(E.eN))},h.\u0275prov=t.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})();var i=n(5204),o=n(8664),v=n(9808),a=n(3075),g=n(8361),_=n(70),U=n(3290),M=n(3455);const I=["image"],y=function(h){return{"is-invalid":h}};function R(h,x){if(1&h){const r=t.EpF();t.ynx(0),t.TgZ(1,"div",3),t._UZ(2,"img",4,5),t.qZA(),t.TgZ(4,"div",6),t._UZ(5,"input",7),t.ALo(6,"async"),t.TgZ(7,"button",8),t.NdJ("click",function(){return t.CHM(r),t.oxw().newCaptcha()}),t._UZ(8,"icon",9),t.qZA()(),t.BQk()}if(2&h){const r=t.oxw();t.xp6(5),t.Q6J("focused",r.focused)("ngClass",t.VKq(5,y,"INVALID"===t.lcZ(6,3,r.form.get("response").statusChanges)&&r.form.get("response").touched)),t.xp6(3),t.Q6J("icon",r.SvgIcon.ArrowCounterclockwise)}}function L(h,x){if(1&h&&(t.ynx(0),t._UZ(1,"re-captcha",10),t.BQk()),2&h){const r=t.oxw();t.xp6(1),t.Q6J("siteKey",r.captchaInput.recaptchaKey)("theme",r.layout.theme)}}let B=(()=>{class h extends P.k{constructor(r,m,p,D){super(r),this.captchaService=m,this.errorHandler=p,this.layout=D}ngAfterViewInit(){this.captchaInput.provider===c.z.INTERNAL&&this.newCaptcha()}ngOnDestroy(){super.ngOnDestroy(),this.revokeCurrent(),this.captchaInput.provider===c.z.INTERNAL&&this.errorHandler.requestWithCustomErrorHandler(()=>this.addSub(this.captchaService.deleteCaptcha({id:this.form.value.challenge}).subscribe()))}revokeCurrent(){this.currentUrl&&(URL.revokeObjectURL(this.currentUrl),this.currentUrl=null)}get img(){return this.image.nativeElement}newCaptcha(){this.captchaInput.provider===c.z.INTERNAL&&this.addSub(this.captchaService.newCaptcha({group:this.group,previousChallenge:this.form.value.challenge}).pipe((0,e.w)(r=>(this.form.patchValue({challenge:r,response:""}),this.loadImage()))).subscribe())}loadImage(){return this.captchaService.getCaptchaContent({id:this.form.value.challenge,group:this.group}).pipe((0,A.b)(m=>{this.revokeCurrent(),this.currentUrl=URL.createObjectURL(m),this.image.nativeElement.style.display="none";const p=new Image;p.onload=()=>this.updateImage(p),p.onerror=()=>setTimeout(()=>this.newCaptcha(),1e3),p.src=this.currentUrl}))}updateImage(r){const m=r.width;m>0&&(this.img.style.width=`${m}px`,this.element.style.width=`${m}px`);const p=this.image.nativeElement;p.src=r.src,p.style.display=""}}return h.\u0275fac=function(r){return new(r||h)(t.Y36(t.zs3),t.Y36(u),t.Y36(i.q),t.Y36(o.Pb))},h.\u0275cmp=t.Xpm({type:h,selectors:[["captcha"]],viewQuery:function(r,m){if(1&r&&t.Gf(I,5),2&r){let p;t.iGM(p=t.CRH())&&(m.image=p.first)}},inputs:{captchaInput:"captchaInput",group:"group",form:"form",focused:"focused"},features:[t.qOj],decls:4,vars:5,consts:[[3,"ngSwitch","formGroup"],[4,"ngSwitchCase"],[3,"control"],[1,"flex-grow-1","d-flex","justify-content-center","mb-1"],["alt","captcha"],["image",""],[1,"d-flex"],["formControlName","response",1,"form-control","mr-1",3,"focused","ngClass"],["type","button",1,"btn","btn-icon",3,"click"],[3,"icon"],["formControlName","response",3,"siteKey","theme"]],template:function(r,m){1&r&&(t.ynx(0,0),t.YNc(1,R,9,7,"ng-container",1),t.YNc(2,L,2,2,"ng-container",1),t.BQk(),t._UZ(3,"field-errors",2)),2&r&&(t.Q6J("ngSwitch",m.captchaInput.provider)("formGroup",m.form),t.xp6(1),t.Q6J("ngSwitchCase","internal"),t.xp6(1),t.Q6J("ngSwitchCase","recaptchaV2"),t.xp6(1),t.Q6J("control",m.form.get("response")))},directives:[v.RF,a.JL,a.sg,v.n9,a.Fj,a.JJ,a.u,g.A,v.mk,_.o,U.wT,U.Vd,M.e],pipes:[v.Ov],encapsulation:2,changeDetection:0}),h})()},4435:(T,O,n)=>{n.d(O,{l:()=>i});var c=n(3075),P=n(723),e=n(6435),A=n(9808),t=n(195),E=n(1321),f=n(6574),C=n(3455);function l(o,v){1&o&&e.GkF(0)}function d(o,v){if(1&o&&(e.TgZ(0,"label-value",2),e.YNc(1,l,1,0,"ng-container",3),e.qZA()),2&o){const a=e.oxw(),g=e.MAs(2);e.Q6J("formField",a.self),e.xp6(1),e.Q6J("ngTemplateOutlet",g)}}function s(o,v){if(1&o&&(e.ynx(0),e.TgZ(1,"div",7)(2,"div"),e._UZ(3,"boolean-field",8),e.qZA(),e._UZ(4,"agreement-link",9),e.qZA(),e.BQk()),2&o){const a=v.$implicit,g=v.index,_=e.oxw(2);e.xp6(3),e.Q6J("formControl",_.agreementsControl.at(g)),e.xp6(1),e.Q6J("agreement",a)}}function u(o,v){if(1&o&&(e.TgZ(0,"div",4),e.YNc(1,s,5,2,"ng-container",5),e.qZA(),e._UZ(2,"field-errors",6)),2&o){const a=e.oxw();e.xp6(1),e.Q6J("ngForOf",a.agreements),e.xp6(1),e.Q6J("control",a.formControl)}}let i=(()=>{class o extends P.T{constructor(a,g,_){super(a,g),this.formBuilder=_}ngOnInit(){super.ngOnInit();const a=this.formControl.value||[],g=this.agreements||[],_=g.map(U=>a.includes(U.id));this.agreementsControl=this.formBuilder.array(_),this.addSub(this.agreementsControl.valueChanges.subscribe(U=>{const M=g.filter((I,y)=>U[y]);this.setValue(M.map(I=>I.id))}))}get acceptedAgreements(){const a=this.value||[];return this.agreements.filter(g=>a.includes(g.id))}getFocusableControl(){throw new Error("Method not implemented.")}getDisabledValue(){return this.acceptedAgreements.map(a=>a.name).sort().join(", ")}validate(a){const g=(this.agreements||[]).filter(_=>_.required);if(g.length>0){const _=a.value||[];for(const U of g)if(!_.includes(U.id))return{required:!0}}return null}}return o.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3),e.Y36(c.gN,13),e.Y36(c.qu))},o.\u0275cmp=e.Xpm({type:o,selectors:[["accept-agreements"]],inputs:{agreements:"agreements"},features:[e._Bn([{provide:c.JU,useExisting:o,multi:!0},{provide:c.Cf,useExisting:o,multi:!0}]),e.qOj],decls:3,vars:2,consts:[[3,"formField",4,"ngIf","ngIfElse"],["widget",""],[3,"formField"],[4,"ngTemplateOutlet"],[1,"optional-agreements"],[4,"ngFor","ngForOf"],[3,"control"],[1,"d-flex","mb-2"],[3,"formControl"],[1,"ml-2","flex-grow-1",3,"agreement"]],template:function(a,g){if(1&a&&(e.YNc(0,d,2,2,"label-value",0),e.YNc(1,u,3,2,"ng-template",null,1,e.W1O)),2&a){const _=e.MAs(2);e.Q6J("ngIf",g.label)("ngIfElse",_)}},directives:[A.O5,t.t,A.tP,A.sg,E.M,c.JJ,c.oH,f.o,C.e],encapsulation:2,changeDetection:0}),o})()},7350:(T,O,n)=>{n.d(O,{N:()=>i});var c=n(7947),P=n(591),e=n(6435),A=n(3868),t=n(5905),E=n(9808),f=n(6903),C=n(1556),l=n(3812),d=n(3317);function s(o,v){if(1&o){const a=e.EpF();e.ynx(0),e.TgZ(1,"div",null,2)(3,"h1"),e._uU(4),e.qZA(),e._UZ(5,"div",3),e.ALo(6,"trust"),e.qZA(),e.TgZ(7,"actions",4)(8,"action-button",5),e.NdJ("action",function(){e.CHM(a);const _=e.MAs(2),U=e.MAs(11);return e.oxw().print(_,U)}),e.qZA(),e.TgZ(9,"action-button",6),e.NdJ("action",function(){return e.CHM(a),e.oxw().modalRef.hide()}),e.qZA()(),e._UZ(10,"iframe",7,8),e.BQk()}if(2&o){const a=v.ngIf,g=e.oxw();e.xp6(4),e.hij(" ",g.agreement.name," "),e.xp6(1),e.Q6J("innerHTML",e.lcZ(6,4,a),e.oJD),e.xp6(3),e.Q6J("label",g.i18n.general.print),e.xp6(1),e.Q6J("label",g.i18n.general.close)}}function u(o,v){1&o&&e._UZ(0,"spinner")}let i=(()=>{class o extends c.H{constructor(a,g,_){super(a),this.agreementsService=g,this.modalRef=_,this.content$=new P.X(null)}ngOnInit(){super.ngOnInit(),this.addSub(this.agreementsService.getAgreementContent({key:this.agreement.id,version:this.version}).subscribe(a=>this.content$.next(a.content)))}print(a,g){const _=g.contentDocument;_.open(),_.write(`<body onload="print()">${a.innerHTML}</body>`),_.close(),this.modalRef.hide()}}return o.\u0275fac=function(a){return new(a||o)(e.Y36(e.zs3),e.Y36(A.T),e.Y36(t.UZ))},o.\u0275cmp=e.Xpm({type:o,selectors:[["agreement-content-dialog"]],inputs:{agreement:"agreement",version:"version"},features:[e.qOj],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],["contentDiv",""],[1,"mb-3",3,"innerHTML"],["forceRow",""],[3,"label","action"],["outline","",3,"label","action"],[1,"d-none"],["printOutput",""]],template:function(a,g){if(1&a&&(e.YNc(0,s,12,6,"ng-container",0),e.ALo(1,"async"),e.YNc(2,u,1,0,"ng-template",null,1,e.W1O)),2&a){const _=e.MAs(3);e.Q6J("ngIf",e.lcZ(1,2,g.content$))("ngIfElse",_)}},directives:[E.O5,f.h,C.x,l.O],pipes:[E.Ov,d.a],encapsulation:2,changeDetection:0}),o})()},6574:(T,O,n)=>{n.d(O,{o:()=>f});var c=n(7350),P=n(6163),e=n(6435),A=n(5905),t=n(9808);function E(C,l){1&C&&(e.TgZ(0,"span",2),e._uU(1,"\xa0*"),e.qZA())}let f=(()=>{class C{constructor(d){this.modal=d,this.classInlineFlex=!0,this._ignoreRequired=!1}get ignoreRequired(){return this._ignoreRequired}set ignoreRequired(d){this._ignoreRequired=(0,P.Iw)(d)}showAgreement(d){this.modal.show(c.N,{ignoreBackdropClick:!0,class:"modal-form modal-form-large",initialState:{agreement:this.agreement,version:this.version}}),d.stopPropagation(),d.preventDefault()}}return C.\u0275fac=function(d){return new(d||C)(e.Y36(A.tT))},C.\u0275cmp=e.Xpm({type:C,selectors:[["agreement-link"]],hostVars:2,hostBindings:function(d,s){2&d&&e.ekj("inline-flex",s.classInlineFlex)},inputs:{agreement:"agreement",version:"version",ignoreRequired:"ignoreRequired"},decls:3,vars:2,consts:[["href","#",1,"inline-block","w-100",3,"click"],["class","required-marker",4,"ngIf"],[1,"required-marker"]],template:function(d,s){1&d&&(e.TgZ(0,"a",0),e.NdJ("click",function(i){return s.showAgreement(i)}),e._uU(1),e.YNc(2,E,2,0,"span",1),e.qZA()),2&d&&(e.xp6(1),e.hij(" ",s.agreement.name," "),e.xp6(1),e.Q6J("ngIf",!s.ignoreRequired&&s.agreement.required))},directives:[t.O5],encapsulation:2,changeDetection:0}),C})()}}]);