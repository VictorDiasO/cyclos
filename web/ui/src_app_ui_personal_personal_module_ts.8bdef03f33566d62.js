"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([["src_app_ui_personal_personal_module_ts"],{2754:(U,C,o)=>{o.d(C,{i:()=>c});var x=o(6435),f=o(6890);let c=(()=>{class p{constructor(h){this.formatService=h}transform(h){return this.formatService.formatAsDateTime(h)}}return p.\u0275fac=function(h){return new(h||p)(x.Y36(f.H,16))},p.\u0275pipe=x.Yjl({name:"dateTime",type:p,pure:!0}),p})()},1548:(U,C,o)=>{o.r(C),o.d(C,{PersonalModule:()=>Jt});var x=o(5300),f=o(5747),c=o(3075),p=o(6163),S=o(2614),h=o(6243),t=o(6435),d=o(520),O=o(1352),b=o(8637),Z=o(2198),y=o(4850),F=o(297);let L=(()=>{class n extends O.b{constructor(e,i){super(e,i)}getDataForInvite$Response(e,i){const r=new b.c(this.rootUrl,n.GetDataForInvitePath,"get");return e&&r.query("fields",e.fields,{explode:!1}),this.http.request(r.build({responseType:"json",accept:"application/json",context:i})).pipe((0,Z.h)(u=>u instanceof d.Zn),(0,y.U)(u=>u))}getDataForInvite(e,i){return this.getDataForInvite$Response(e,i).pipe((0,y.U)(r=>r.body))}sendInvitation$Response(e,i){const r=new b.c(this.rootUrl,n.SendInvitationPath,"post");return e&&r.body(e.body,"application/json"),this.http.request(r.build({responseType:"text",accept:"*/*",context:i})).pipe((0,Z.h)(u=>u instanceof d.Zn),(0,y.U)(u=>u.clone({body:void 0})))}sendInvitation(e,i){return this.sendInvitation$Response(e,i).pipe((0,y.U)(r=>r.body))}}return n.GetDataForInvitePath="/invite/data-for-send",n.SendInvitationPath="/invite",n.\u0275fac=function(e){return new(e||n)(t.LFG(F.p),t.LFG(d.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var m=o(1963),v=o(9808),s=o(2032),l=o(723),g=o(3728),N=o(195),J=o(70),M=o(3455);function Y(n,a){1&n&&t.GkF(0)}function B(n,a){if(1&n&&(t.TgZ(0,"label-value",2),t.YNc(1,Y,1,0,"ng-container",3),t.qZA()),2&n){const e=t.oxw(),i=t.MAs(2);t.Q6J("formField",e.self)("informationText",e.informationText),t.xp6(1),t.Q6J("ngTemplateOutlet",i)}}function H(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw(3).add()}),t._UZ(1,"icon",11),t.qZA()}if(2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("icon",e.SvgIcon.PlusCircle)}}function X(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(2).remove(r)}),t._UZ(1,"icon",11),t.qZA()}if(2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("icon",e.SvgIcon.DashCircle)}}function V(n,a){if(1&n&&(t.TgZ(0,"div",7),t._UZ(1,"input-field",8),t.YNc(2,H,2,1,"button",9),t.YNc(3,X,2,1,"button",9),t.qZA()),2&n){const e=a.index,i=a.last,r=t.oxw(2);t.xp6(1),t.Q6J("formControl",r.getControl(e)),t.xp6(1),t.Q6J("ngIf",i&&e<r.maxItems-1),t.xp6(1),t.Q6J("ngIf",!i)}}function G(n,a){if(1&n&&t._UZ(0,"field-errors",12),2&n){const e=t.oxw(2);t.Q6J("control",e.formControl)}}function z(n,a){if(1&n&&(t.TgZ(0,"div",4),t.YNc(1,V,4,3,"div",5),t.qZA(),t.YNc(2,G,1,1,"field-errors",6)),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.array.controls),t.xp6(1),t.Q6J("ngIf",e.formControl)}}let j=(()=>{class n extends l.T{constructor(e,i,r){super(e,i),this.changeDetector=r,this.arraySubs=[]}ngOnInit(){this.array=new c.Oe([new c.NI(null)]),this.setupArraySubs()}ngOnDestroy(){this.arraySubs.forEach(e=>e.unsubscribe())}getFocusableControl(){return this.inputs.first}getControl(e){return this.array.controls[e]}add(){this.array.insert(this.array.length,new c.NI(null)),this.setupArraySubs(),setTimeout(()=>(0,p.T_)(this.inputs.last))}remove(e){this.array.removeAt(e),this.arraySubs[e].unsubscribe(),this.arraySubs.splice(e,1),this.value=this.array.value.filter(i=>!(0,p.cS)(i))}writeValue(e){super.writeValue(e);const i=e instanceof Array?e:((0,p.cS)(e),[]);this.array.clear(),this.array=new c.Oe(0===i.length?[new c.NI(null)]:i.map(r=>new c.NI(r))),this.setupArraySubs(),this.changeDetector.detectChanges()}getDisabledValue(){return(this.array.value||[]).filter(e=>!(0,p.cS)(e)).join(", ")}setupArraySubs(){this.arraySubs.forEach(e=>e.unsubscribe()),this.arraySubs=this.array.controls.map((e,i)=>e.valueChanges.subscribe(r=>{const u=this.array.value;u[i]=r,this.value=u.filter(T=>!(0,p.cS)(T))}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.zs3),t.Y36(c.gN,13),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["input-list-field"]],viewQuery:function(e,i){if(1&e&&t.Gf(g.q,5),2&e){let r;t.iGM(r=t.CRH())&&(i.inputs=r)}},inputs:{maxItems:"maxItems"},features:[t._Bn([{provide:c.JU,useExisting:n,multi:!0}]),t.qOj],decls:3,vars:2,consts:[[3,"formField","informationText",4,"ngIf","ngIfElse"],["widget",""],[3,"formField","informationText"],[4,"ngTemplateOutlet"],[1,"input-fields"],["class","field-and-action",4,"ngFor","ngForOf"],[3,"control",4,"ngIf"],[1,"field-and-action"],[3,"formControl"],["type","button","class","btn btn-icon",3,"click",4,"ngIf"],["type","button",1,"btn","btn-icon",3,"click"],[3,"icon"],[3,"control"]],template:function(e,i){if(1&e&&(t.YNc(0,B,2,3,"label-value",0),t.YNc(1,z,3,2,"ng-template",null,1,t.W1O)),2&e){const r=t.MAs(2);t.Q6J("ngIf",i.label)("ngIfElse",r)}},directives:[v.O5,N.t,v.tP,v.sg,g.q,c.JJ,c.oH,J.o,M.e],encapsulation:2,changeDetection:0}),n})();var W=o(8361),w=o(1321),Q=o(6903),E=o(1556);function K(n,a){if(1&n&&t._UZ(0,"boolean-field",8),2&n){const e=t.oxw(2);t.Q6J("label",e.i18n.invite.assignBroker)}}function k(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"page-content",2),t._UZ(1,"input-list-field",3),t.YNc(2,K,1,1,"boolean-field",4),t._UZ(3,"label-value",5)(4,"label-value",6),t.TgZ(5,"actions")(6,"action-button",7),t.NdJ("action",function(){return t.CHM(e),t.oxw().send()}),t.qZA()()()}if(2&n){const e=t.oxw();t.Q6J("heading",e.i18n.invite.title)("mobileHeading",e.i18n.invite.mobileTitle)("formGroup",e.form),t.xp6(1),t.Q6J("maxItems",null==e.data?null:e.data.maxRecipients)("label",1===(null==e.data?null:e.data.maxRecipients)?e.i18n.invite.toEmail:e.i18n.invite.toEmails),t.xp6(1),t.Q6J("ngIf","broker"===(null==e.dataForFrontendHolder.auth?null:e.dataForFrontendHolder.auth.role)),t.xp6(1),t.Q6J("label",e.i18n.invite.subject)("value",e.data.subject),t.xp6(1),t.Q6J("label",e.i18n.invite.body)("value",e.data.body),t.xp6(2),t.Q6J("label",e.i18n.invite.send)}}let q=(()=>{class n extends S.y{constructor(e,i){super(e),this.inviteService=i}ngOnInit(){super.ngOnInit(),this.addSub(this.inviteService.getDataForInvite().subscribe(e=>this.data=e))}onDataInitialized(e){this.form=new c.cw({toEmails:this.formBuilder.control([]),assignBroker:this.formBuilder.control(!1)}),this.form.patchValue(e.send)}send(){if(!(0,p.pt)(this.form))return;const e=this.form.value;this.addSub(this.inviteService.sendInvitation({body:e}).subscribe(()=>{var i;1===(null===(i=e.toEmails)||void 0===i?void 0:i.length)?this.notification.snackBar(this.i18n.invite.sentSingle):this.notification.snackBar(this.i18n.invite.sentMultiple),this.form.patchValue(this.data.send)}))}resolveMenu(){return h.v2.INVITE}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.zs3),t.Y36(L))},n.\u0275cmp=t.Xpm({type:n,selectors:[["send-invitation"]],features:[t.qOj],decls:3,vars:4,consts:[[3,"ready"],["last","",3,"heading","mobileHeading","formGroup",4,"ngIf"],["last","",3,"heading","mobileHeading","formGroup"],["focused","","formControlName","toEmails",3,"maxItems","label"],["formControlName","assignBroker",3,"label",4,"ngIf"],["kind","fieldView",3,"label","value"],["kind","fieldView","valueFormat","html",3,"label","value"],[3,"label","action"],["formControlName","assignBroker",3,"label"]],template:function(e,i){1&e&&(t.TgZ(0,"page-layout",0),t.ALo(1,"async"),t.YNc(2,k,7,11,"page-content",1),t.qZA()),2&e&&(t.Q6J("ready",t.lcZ(1,2,i.data$)),t.xp6(2),t.Q6J("ngIf",i.form))},directives:[m.w,v.O5,s.Y,c.JL,c.sg,j,W.A,c.JJ,c.u,w.M,N.t,Q.h,E.x],pipes:[v.Ov],encapsulation:2,changeDetection:0}),n})();var _=o(1879),R=o(5466),$=o(7e3),tt=o(2292),et=o(567),D=o(7224),nt=o(1307),it=o(8041),ot=o(8687),st=o(1441),at=o(629),rt=o(8397),lt=o(1015),ct=o(867),ut=o(2754);function dt(n,a){if(1&n&&(t.TgZ(0,"mobile-result",8)(1,"div",9),t._uU(2),t.qZA(),t.TgZ(3,"div",10),t._uU(4),t.ALo(5,"dateTime"),t.qZA()()),2&n){const e=a.$implicit,i=t.oxw();t.Q6J("avatarImage",null==e.relatedUser?null:e.relatedUser.image)("avatarIcon",i.SvgIcon.Bell),t.xp6(1),t.Q6J("tooltip",e.message),t.xp6(1),t.Oqu(e.subject),t.xp6(1),t.Q6J("tooltip",e.message),t.xp6(1),t.hij(" ",t.lcZ(5,6,e.date)," ")}}const pt=function(n){return{"font-weight-bold":n}},ht=function(n,a){return{"pb-0":n,"border-0":a}};function mt(n,a){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr",15),t.NdJ("click",function(){const u=t.CHM(e).$implicit;return t.oxw(2).rowClick(u)}),t.TgZ(2,"td",16),t.ALo(3,"async"),t.ALo(4,"async"),t._UZ(5,"avatar",17),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"dateTime"),t.qZA(),t._UZ(9,"td",18),t.TgZ(10,"td",13)(11,"button",19),t.NdJ("click",function(r){const T=t.CHM(e).$implicit;return t.oxw(2).remove(T),r.stopPropagation()}),t._UZ(12,"icon",20),t.qZA()()(),t.BQk()}if(2&n){const e=a.$implicit,i=t.oxw(2);t.xp6(1),t.Q6J("ngClass",t.VKq(15,pt,!e.read)),t.xp6(1),t.Q6J("ngClass",t.WLB(17,ht,t.lcZ(3,9,i.layout.xxs$),t.lcZ(4,11,i.layout.xxs$))),t.xp6(3),t.Q6J("image",null==e.relatedUser?null:e.relatedUser.image)("tooltip",null==e.relatedUser?null:e.relatedUser.display)("icon",i.SvgIcon.Bell),t.xp6(2),t.Oqu(t.lcZ(8,13,e.date)),t.xp6(2),t.Q6J("innerHTML",e.message,t.oJD),t.xp6(2),t.Q6J("tooltip",i.i18n.notification.actions.remove),t.xp6(1),t.Q6J("icon",i.SvgIcon.Trash)}}function ft(n,a){if(1&n&&(t.TgZ(0,"table",11)(1,"thead"),t._UZ(2,"th",12),t.TgZ(3,"th"),t._uU(4),t.qZA(),t.TgZ(5,"th"),t._uU(6),t.qZA(),t._UZ(7,"th",13),t.qZA(),t.TgZ(8,"tbody"),t.YNc(9,mt,13,20,"ng-container",14),t.ALo(10,"async"),t.qZA()()),2&n){const e=t.oxw();let i;t.xp6(4),t.Oqu(e.i18n.general.date),t.xp6(2),t.Oqu(e.i18n.notification.message),t.xp6(3),t.Q6J("ngForOf",null==(i=t.lcZ(10,3,e.results$))?null:i.results)}}let gt=(()=>{class n extends tt.t{constructor(e,i){super(e),this.notificationsService=i}ngOnInit(){var e,i,r;super.ngOnInit(),this.data={},this.addSub(this.notificationsService.updateLastViewDateForNotifications().pipe((0,D.P)()).subscribe(()=>{const T=this.notification.notificationsStatus$,I=Object.assign({},T.value);I.lastViewDate=this.dataForFrontendHolder.now().toISOString(),I.newNotifications=0,T.next(I),this.addSub(this.notification.notificationsStatus$.pipe((0,nt.T)(1)).subscribe(()=>this.update()))}));const u=(null===(r=null===(i=null===(e=this.dataForFrontendHolder.auth)||void 0===e?void 0:e.permissions)||void 0===i?void 0:i.notificationSettings)||void 0===r?void 0:r.enable)?new R.Yu(_.l.BellSlash,this.i18n.notification.actions.settings,()=>{this.router.navigate(["/users",$.S.SELF,"notification-settings"])},!0):null;u&&(this.headingActions=[u]),this.addSub(this.results$.subscribe(T=>{const I=(T?T.results:null)||[],Ot=I.filter(A=>!A.read),P=()=>{const A=[];Ot.length>0&&A.push(new R.Yu(_.l.Check2All,this.i18n.notification.actions.markAllRead,()=>this.markAllRead())),I.length>0&&A.push(new R.Yu(_.l.Trash,this.i18n.notification.actions.removeAll,()=>this.removeAll())),u&&A.push(u),this.headingActions=A};P(),this.addSub(this.layout.breakpointChanges$.subscribe(P))}))}rowClick(e){this.addSub(this.notificationsService.markNotificationsAsRead({ids:[e.id]}).subscribe());const i=this.path(e);i&&this.router.navigateByUrl(i)}remove(e){this.addSub(this.notificationsService.deleteNotification({id:e.id}).subscribe(()=>this.update()))}path(e){return $.S.notificationPath(e)}markAllRead(){this.addSub(this.notificationsService.markNotificationsAsRead({ids:this.ids}).subscribe(()=>this.update()))}removeAll(){const e=[];for(const i of this.ids)e.push(this.notificationsService.deleteNotification({id:i}));this.addSub((0,et.D)(e).pipe((0,D.P)()).subscribe(()=>this.update()))}get ids(){return this.results&&this.results.results?this.results.results.map(e=>e.id):[]}getFormControlNames(){return["onlyUnread"]}toSearchParams(e){return e}doSearch(e){return this.notificationsService.searchNotifications$Response(e)}get onClick(){return e=>this.rowClick(e)}resolveMenu(){return h.v2.NOTIFICATIONS}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.zs3),t.Y36(it.T))},n.\u0275cmp=t.Xpm({type:n,selectors:[["search-notifications"]],features:[t.qOj],decls:11,vars:12,consts:[["mode","filters",3,"heading","mobileHeading","headingActions"],[1,"filters-form","filters-form-separator",3,"formGroup"],[1,"row"],[1,"col-12"],["formControlName","onlyUnread",3,"label"],["resultType","list",3,"results","onClick","rendering$","update"],[3,"avatarImage","avatarIcon",4,"mobileResult"],["class","table table-hover cursor-pointer",4,"resultTable"],[3,"avatarImage","avatarIcon"],[1,"cell-main",3,"tooltip"],[1,"cell-cell-date",3,"tooltip"],[1,"table","table-hover","cursor-pointer"],[1,"avatar"],[1,"actions"],[4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"avatar",3,"ngClass"],[3,"image","tooltip","icon"],[3,"innerHTML"],["type","button",1,"btn","btn-icon",3,"tooltip","click"],[3,"icon"]],template:function(e,i){1&e&&(t.TgZ(0,"page-layout")(1,"page-content",0),t.ALo(2,"async"),t.TgZ(3,"div",1)(4,"div",2)(5,"div",3),t._UZ(6,"boolean-field",4),t.qZA()()()(),t.TgZ(7,"results-layout",5),t.NdJ("update",function(u){return i.update(u)}),t.ALo(8,"async"),t.YNc(9,dt,6,8,"mobile-result",6),t.YNc(10,ft,11,5,"table",7),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("heading",i.i18n.notification.title)("mobileHeading",i.i18n.notification.mobileTitle)("headingActions",t.lcZ(2,8,i.headingActions$)),t.xp6(2),t.Q6J("formGroup",i.form),t.xp6(3),t.Q6J("label",i.i18n.notification.onlyUnread),t.xp6(1),t.Q6J("results",t.lcZ(8,10,i.results$))("onClick",i.onClick)("rendering$",i.rendering$))},directives:[m.w,s.Y,c.JL,c.sg,w.M,c.JJ,c.u,ot.D,st.E,at.t,rt.i9,lt.p,v.sg,v.mk,ct.A,J.o],pipes:[v.Ov,ut.i],encapsulation:2,changeDetection:0}),n})();var vt=o(2340),Tt=o(5739),bt=o(8868),xt=o(7816);function yt(n,a){if(1&n&&t._UZ(0,"radio-group-field",6),2&n){const e=t.oxw(2);t.Q6J("label",e.i18n.setting.locale)("formControl",e.localeControl)("fieldOptions",e.localeOptions)}}function It(n,a){if(1&n&&t._UZ(0,"single-selection-field",6),2&n){const e=t.oxw(2);t.Q6J("label",e.i18n.setting.locale)("formControl",e.localeControl)("fieldOptions",e.localeOptions)}}function Ct(n,a){if(1&n&&(t.ynx(0),t.YNc(1,yt,1,3,"radio-group-field",5),t.ALo(2,"async"),t.YNc(3,It,1,3,"single-selection-field",5),t.ALo(4,"async"),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,e.layout.gtxs$)&&e.localeOptions.length<=2),t.xp6(2),t.Q6J("ngIf",t.lcZ(4,4,e.layout.ltsm$)||e.localeOptions.length>2)}}function St(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"actions",7),t._UZ(1,"span"),t.TgZ(2,"action-button",8),t.NdJ("action",function(){return t.CHM(e),t.oxw().switchFrontend()}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("label",e.i18n.setting.useClassicFrontend)}}const At=[{path:"",children:[{path:"notifications",component:gt,canActivate:[f.b],data:{menu:h.v2.NOTIFICATIONS}},{path:"settings",component:(()=>{class n extends S.y{constructor(e){super(e)}ngOnInit(){super.ngOnInit(),this.data=!0}onDataInitialized(){var e;this.darkThemeControl=new c.NI(this.layout.darkTheme),this.addSub(this.darkThemeControl.valueChanges.subscribe(u=>{this.layout.darkTheme=u}));const i=this.dataForFrontendHolder.dataForFrontend.dataForUi,r=i.allowedLocales;r.length>1&&(this.localeControl=new c.NI(null===(e=i.currentLocale)||void 0===e?void 0:e.code),this.localeOptions=r.map(u=>({value:u.code,text:u.name})),this.addSub(this.localeControl.valueChanges.subscribe(u=>this.authHelper.setLocale(u)))),this.canSwitchFrontend=!vt.N.standalone&&this.dataForFrontendHolder.dataForFrontend.allowFrontendSwitching}switchFrontend(){this.dataForFrontendHolder.useClassicFrontend()}resolveMenu(){return h.v2.SETTINGS}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.zs3))},n.\u0275cmp=t.Xpm({type:n,selectors:[["manage-settings"]],features:[t.qOj],decls:7,vars:10,consts:[["last","",3,"heading","mobileHeading"],[3,"label","formControl"],[3,"value","text"],[4,"ngIf"],["kind","secondary",4,"ngIf"],[3,"label","formControl","fieldOptions",4,"ngIf"],[3,"label","formControl","fieldOptions"],["kind","secondary"],["outline","",3,"label","action"]],template:function(e,i){1&e&&(t.TgZ(0,"page-layout")(1,"page-content",0)(2,"radio-group-field",1),t._UZ(3,"field-option",2)(4,"field-option",2),t.qZA(),t.YNc(5,Ct,5,6,"ng-container",3),t.YNc(6,St,3,1,"actions",4),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("heading",i.i18n.setting.title)("mobileHeading",i.i18n.setting.mobileTitle),t.xp6(1),t.Q6J("label",i.i18n.setting.theme)("formControl",i.darkThemeControl),t.xp6(1),t.Q6J("value",!1)("text",i.i18n.setting.themeLight),t.xp6(1),t.Q6J("value",!0)("text",i.i18n.setting.themeDark),t.xp6(1),t.Q6J("ngIf",i.localeControl),t.xp6(1),t.Q6J("ngIf",i.canSwitchFrontend))},directives:[m.w,s.Y,Tt.Y,c.JJ,c.oH,bt.s,v.O5,xt.f,Q.h,E.x],pipes:[v.Ov],encapsulation:2,changeDetection:0}),n})(),canActivate:[f.b],data:{menu:h.v2.SETTINGS}},{path:"invite",component:q,canActivate:[f.b],data:{menu:h.v2.INVITE}}]}];let Zt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[x.Bz.forChild(At)],x.Bz]}),n})();var Nt=o(4443);let Jt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[Zt,Nt.C]]}),n})()},2292:(U,C,o)=>{o.d(C,{t:()=>L});var x=o(3075),f=(()=>{return(m=f||(f={})).LIST="list",m.LIST_THUMB="list_thumb",m.MAP="map",m.TILED="tiled",f;var m})(),c=o(543),p=o(5466),S=o(7e3),h=o(2614),t=o(6897),d=o(8473),O=o(3531),b=o(591),Z=o(13),y=o(1879),F=o(6435);let L=(()=>{class m extends h.y{constructor(s){super(s),this.ResultType=d.X,this.resultType$=new b.X(null),this.resultTypeControl=new x.NI(null),this.results$=new b.X(null),this.allowedResultTypes$=new b.X([d.X.LIST]),this.rendering$=new b.X(!1),this.moreFilters$=new b.X(!1),this.ignoreNextUpdate=!1,this.nextRequestState=s.get(c.AM);const l={page:0};l.resultType=this.getInitialResultType();for(const g of this.getFormControlNames()||[])l[g]=null;this.form=this.formBuilder.group(l)}getInitialFormValue(s){return s.query||{}}prepareForm(s){}onDataInitialized(s){this.prepareForm(s),this.form.patchValue(this.getInitialFormValue(s)),this.stateManager.manage(this.form),this.stateManager.manage(this.resultTypeControl,"resultType"),this.stateManager.manageValue(this.moreFilters$,"moreFilters"),this.previousValue=this.form.value,this.previousResultType=this.resultType,this.resultType$.next(this.previousResultType),this.addSub(this.resultTypeControl.valueChanges.subscribe(l=>{const g=this.previousResultType;this.previousResultType=l,this.resultType$.next(l),this.shouldUpdateOnResultTypeChange(l,g)&&this.update(),(null==g||g!==l)&&(this.rendering=!0,this.stateManager.set("resultType",l),this.onResultTypeChanged(l,g))})),setTimeout(()=>{this.addSub(this.form.valueChanges.pipe((0,Z.b)(S.S.DEBOUNCE_TIME)).subscribe(l=>{this.shouldUpdateOnChange(l)&&this.update(),this.previousValue=l}),!0),this.previousResultType!==d.X.CATEGORIES&&this.update()},1)}shouldUpdateOnResultTypeChange(s,l){return s!==d.X.CATEGORIES&&([d.X.LIST,d.X.TILES].includes(l)!==[d.X.LIST,d.X.TILES].includes(s)||l===d.X.MAP!=(s===d.X.MAP))}shouldUpdateOnChange(s){return!(0,O.Z)(this.previousValue,s)}get results(){return this.results$.value}set results(s){this.onBeforeRender(s),this.results$.next(s)}onBeforeRender(s){}get rendering(){return this.rendering$.value}set rendering(s){this.rendering$.next(s)}get allowedResultTypes(){return this.allowedResultTypes$.value}set allowedResultTypes(s){this.allowedResultTypes$.next(s)}get moreFilters(){return this.moreFilters$.value}set moreFilters(s){this.moreFilters$.next(s)}get pageData(){const s=this.form.value;return{page:s.page,pageSize:s.pageSize}}set pageData(s){this.form.patchValue(s)}get resultType(){return this.resultTypeControl.value}set resultType(s){null==s&&(s=this.getInitialResultType()),this.resultTypeControl.setValue(s)}ngOnInit(){super.ngOnInit(),this.resultType=this.getInitialResultType()}get moreFiltersAction(){return this._moreFiltersAction||(this._moreFiltersAction=new p.Yu(this.showMoreFiltersIcon(),this.showMoreFiltersLabel(),()=>{this.moreFilters=!this.moreFilters,this._moreFiltersAction.icon=this.moreFilters?this.showLessFiltersIcon():this.showMoreFiltersIcon(),this._moreFiltersAction.label=this.moreFilters?this.showLessFiltersLabel():this.showMoreFiltersLabel()},!0),this._moreFiltersAction.breakpoint="gt-xxs",this._moreFiltersAction.maybeRoot=!0),this._moreFiltersAction}getResultType(s){let l=null;switch(s){case f.LIST:case f.LIST_THUMB:l=d.X.LIST;break;case f.MAP:l=d.X.MAP;break;case f.TILED:l=d.X.TILES}return this.allowedResultTypes.includes(l)||(l=this.allowedResultTypes[0]),l}showMoreFiltersLabel(){return this.i18n.general.showMoreFilters}showLessFiltersLabel(){return this.i18n.general.showLessFilters}showMoreFiltersIcon(){return y.l.Funnel}showLessFiltersIcon(){return y.l.Funnel}onResultTypeChanged(s,l){}getInitialResultType(){return d.X.LIST}update(s){if(this.ignoreNextUpdate||this.resultType===d.X.CATEGORIES)return;s&&(this.form.patchValue(s,{emitEvent:!1}),this.stateManager.set("form",this.form.value)),this.rendering=!0,this.results=null,this.nextRequestState.leaveNotification=!0;const l=this.form.value;l.pageSize=this.uiLayout.searchPageSize,this.addSub(this.doSearch(this.toSearchParams(l)).subscribe(g=>{this.resultType===d.X.CATEGORIES&&(this.resultType=this.getDefaultResultType()),this.results=t.x.from(g)}))}resetPage(s=!1){this.form.patchValue({page:0},{emitEvent:s})}getDefaultResultType(){return this.allowedResultTypes.find(s=>s!==d.X.CATEGORIES)}doIgnoringUpdate(s){this.ignoreNextUpdate=!0;try{s()}finally{this.ignoreNextUpdate=!1}}}return m.\u0275fac=function(s){return new(s||m)(F.Y36(F.zs3))},m.\u0275dir=F.lG2({type:m,features:[F.qOj]}),m})()}}]);