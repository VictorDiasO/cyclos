"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([["src_app_ui_operations_operations_module_ts"],{203:(ae,v,r)=>{r.r(v),r.d(v,{OperationsModule:()=>oe});var y=r(5300),f=r(5747),b=r(4131),C=r(2614),d=r(6243),t=r(6435),S=r(979),N=r(1963),u=r(9808),Z=r(2032),E=r(5350);function F(n,i){if(1&n&&(t.TgZ(0,"page-content",2)(1,"alert",3)(2,"div",4),t._uU(3),t.qZA()()()),2&n){const e=t.oxw();t.Q6J("heading",e.data.title),t.xp6(1),t.Q6J("type",e.alertType),t.xp6(2),t.Oqu(e.data.notification)}}let M=(()=>{class n extends C.y{constructor(e,o){super(e),this.operationsService=o,this.alertType="success"}ngOnInit(){const e=this.route.snapshot;super.ngOnInit(),this.addSub(this.operationsService.runCustomOperationCallback({id:e.params.id,token:e.params.token,body:{method:"GET",parameters:e.queryParams}}).subscribe(o=>{o.notificationLevel===b.s.WARNING?this.alertType="warning":o.notificationLevel===b.s.ERROR&&(this.alertType="danger"),this.data=o}))}resolveMenu(){return this.login.user?d.v2.DASHBOARD:d.v2.HOME}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.zs3),t.Y36(S.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["operation-callback"]],features:[t.qOj],decls:3,vars:4,consts:[[3,"ready"],["last","",3,"heading",4,"ngIf"],["last","",3,"heading"],[3,"type"],[1,"break-nl"]],template:function(e,o){1&e&&(t.TgZ(0,"page-layout",0),t.ALo(1,"async"),t.YNc(2,F,4,3,"page-content",1),t.qZA()),2&e&&(t.Q6J("ready",t.lcZ(1,2,o.data$)),t.xp6(2),t.Q6J("ngIf",o.data))},directives:[N.w,u.O5,Z.Y,E.wx],pipes:[u.Ov],encapsulation:2,changeDetection:0}),n})();var l=(()=>{return(n=l||(l={})).User="user",n.Ad="ad",n.Record="record",n.Transfer="transfer",n.Menu="menu",n.Standalone="standalone",l;var n})(),P=r(520),L=r(871),O=r(170),h=(()=>{return(n=h||(h={})).LOCATION="location",n.OPERATION="operation",n.URL="url",h;var n})(),m=(()=>{return(n=m||(m={})).BOOLEAN="boolean",n.CURRENCY_AMOUNT="currencyAmount",n.DATE="date",n.NUMBER="number",n.STRING="string",m;var n})(),I=r(3665),Y=r(5466),T=r(7e3),A=r(6163),J=r(6897),D=r(1375),R=r(591),U=r(13),Q=r(7224),$=r(2868),q=r(9175),B=r(6527),k=r(7055),G=r(543),j=r(5905),x=r(3075),X=r(6903),W=r(1556),z=r(8687),V=r(1441),K=r(629),tt=r(195),et=r(1015),nt=r(70),ot=r(1602),at=r(8361),it=r(3450),rt=r(3594),st=r(3317);function ct(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"alert",7),t._uU(2),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(2),t.hij(" ",e.i18n.operation.alreadyExecuted," ")}}function lt(n,i){1&n&&t.GkF(0)}function pt(n,i){if(1&n&&(t.TgZ(0,"alert",15),t._UZ(1,"div",16),t.ALo(2,"trust"),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,e.data.informationText),t.oJD)}}function ut(n,i){1&n&&t.GkF(0)}function _t(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"action-button",20),t.NdJ("action",function(){return t.CHM(e),t.oxw(4).run()}),t.ALo(1,"async"),t.qZA()}if(2&n){const e=t.oxw(4);t.Q6J("disabled",t.lcZ(1,2,e.requesting$))("label",e.data.customSubmitLabel||e.i18n.general.submit)}}function mt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"action-button",21),t.NdJ("action",function(){const s=t.CHM(e).$implicit;return t.oxw(4).runPrimaryAction(s)}),t.qZA()}2&n&&t.Q6J("label",i.$implicit.action.label)}function gt(n,i){if(1&n&&(t.TgZ(0,"actions",17),t.YNc(1,_t,2,4,"action-button",18),t.ALo(2,"async"),t.YNc(3,mt,1,1,"action-button",19),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!t.lcZ(2,2,e.runDirectly$)),t.xp6(2),t.Q6J("ngForOf",e.primaryActions)}}function ft(n,i){if(1&n&&t._UZ(0,"label-value",26),2&n){const e=i.$implicit,o=t.oxw().$implicit;t.Q6J("label",e.header)("value",o[e.property])}}function dt(n,i){if(1&n&&(t.TgZ(0,"mobile-result"),t.YNc(1,ft,1,2,"label-value",25),t.ALo(2,"async"),t.qZA()),2&n){const e=t.oxw(4);let o;t.xp6(1),t.Q6J("ngForOf",null==(o=t.lcZ(2,1,e.result$))?null:o.columns)}}const ht=function(n,i){return{textAlign:n,width:i}};function xt(n,i){if(1&n&&(t.TgZ(0,"th",30),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.Q6J("ngStyle",t.WLB(2,ht,e.align,e.width)),t.xp6(1),t.hij(" ",e.header," ")}}const Ot=function(n){return{textAlign:n}};function Tt(n,i){if(1&n&&(t._UZ(0,"td",33),t.ALo(1,"trust")),2&n){const e=i.$implicit,o=t.oxw().$implicit,a=t.oxw(5);t.Q6J("ngStyle",t.VKq(4,Ot,e.align))("innerHTML",t.lcZ(1,2,a.formatCell(o[e.property],e)),t.oJD)}}function At(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr",31),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(5).rowClick(s)}),t.YNc(1,Tt,2,6,"td",32),t.ALo(2,"async"),t.qZA()}if(2&n){const e=t.oxw(5);let o;t.xp6(1),t.Q6J("ngForOf",null==(o=t.lcZ(2,1,e.result$))?null:o.columns)}}const Rt=function(n){return{"cursor-pointer":n}};function vt(n,i){if(1&n&&(t.TgZ(0,"table",27)(1,"thead"),t.YNc(2,xt,2,5,"th",28),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"tbody"),t.YNc(5,At,3,3,"tr",29),t.ALo(6,"async"),t.qZA()()),2&n){const e=t.oxw(4);let o,a;t.Q6J("ngClass",t.VKq(7,Rt,e.data.rowAction)),t.xp6(2),t.Q6J("ngForOf",null==(o=t.lcZ(3,3,e.result$))?null:o.columns),t.xp6(3),t.Q6J("ngForOf",null==(a=t.lcZ(6,5,e.result$))?null:a.rows)}}function yt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"results-layout",22),t.NdJ("update",function(a){return t.CHM(e),t.oxw(3).updatePage(a)}),t.YNc(1,dt,3,3,"mobile-result",23),t.YNc(2,vt,7,9,"table",24),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("results",e.pageResults)("onClick",e.onClick)}}function bt(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"page-content",9),t.ALo(2,"async"),t.ALo(3,"async"),t.YNc(4,pt,3,3,"alert",10),t.TgZ(5,"div",11),t.YNc(6,ut,1,0,"ng-container",12),t.qZA(),t.YNc(7,gt,4,4,"actions",13),t.ALo(8,"async"),t.qZA(),t.YNc(9,yt,3,2,"results-layout",14),t.ALo(10,"async"),t.BQk()),2&n){const e=t.oxw(2),o=t.MAs(9);t.xp6(1),t.Q6J("mode",!t.lcZ(2,9,e.runDirectly$)||null!=e.primaryActions&&e.primaryActions.length||e.hasSearchFields||e.data.informationText?"filters":"emptyFilters")("heading",e.data.name)("mobileHeading",e.data.label)("headingActions",t.lcZ(3,11,e.headingActions$)),t.xp6(3),t.Q6J("ngIf",e.data.informationText),t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("ngTemplateOutlet",o),t.xp6(1),t.Q6J("ngIf",!t.lcZ(8,13,e.runDirectly$)||(null==e.primaryActions?null:e.primaryActions.length)),t.xp6(2),t.Q6J("ngIf",t.lcZ(10,15,e.pageResults$))}}function Ct(n,i){if(1&n&&t.YNc(0,bt,11,17,"ng-container",8),2&n){const e=t.oxw(),o=t.MAs(7);t.Q6J("ngIf",e.isSearch)("ngIfElse",o)}}function St(n,i){if(1&n&&(t.TgZ(0,"alert",41),t._UZ(1,"div",16),t.ALo(2,"trust"),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,e.data.informationText),t.oJD)}}function Nt(n,i){1&n&&t.GkF(0)}function Zt(n,i){if(1&n&&(t.TgZ(0,"div",46),t._uU(1),t.qZA()),2&n){const e=t.oxw(4);t.xp6(1),t.Oqu(e.data.customSubmitLabel)}}function Et(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",42)(1,"button",43),t.NdJ("click",function(){return t.CHM(e),t.oxw(3).run()}),t._UZ(2,"icon",44),t.qZA(),t.YNc(3,Zt,2,1,"div",45),t.qZA()}if(2&n){const e=t.oxw(3);t.xp6(2),t.Q6J("icon",e.SvgIcon.QrCodeScan),t.xp6(1),t.Q6J("ngIf",e.data.customSubmitLabel)}}function It(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"action-button",21),t.NdJ("action",function(){const s=t.CHM(e).$implicit;return t.oxw(4).runPrimaryAction(s)}),t.qZA()}2&n&&t.Q6J("label",i.$implicit.action.label)}function Jt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"actions")(1,"action-button",20),t.NdJ("action",function(){return t.CHM(e),t.oxw(3).run()}),t.ALo(2,"async"),t.qZA(),t.YNc(3,It,1,1,"action-button",19),t.qZA()}if(2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("disabled",t.lcZ(2,3,e.requesting$))("label",e.data.customSubmitLabel||e.i18n.general.submit),t.xp6(2),t.Q6J("ngForOf",e.primaryActions)}}function Qt(n,i){if(1&n&&(t.TgZ(0,"div",47),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.i18n.operation.redirecting," ")}}const wt=function(n){return{"mt-3":n}};function Ht(n,i){if(1&n&&(t.TgZ(0,"page-content",36),t.ALo(1,"async"),t.YNc(2,St,3,3,"alert",37),t.TgZ(3,"div",38),t.YNc(4,Nt,1,0,"ng-container",12),t.qZA(),t.YNc(5,Et,4,2,"div",39),t.YNc(6,Jt,4,5,"actions",1),t.ALo(7,"async"),t.YNc(8,Qt,2,1,"div",40),t.ALo(9,"async"),t.qZA()),2&n){const e=t.oxw(2),o=t.MAs(9);t.Q6J("heading",e.data.name)("mobileHeading",e.data.label)("headingActions",t.lcZ(1,9,e.headingActions$)),t.xp6(2),t.Q6J("ngIf",e.data.informationText),t.xp6(1),t.Q6J("ngClass",t.VKq(15,wt,e.data.informationText)),t.xp6(1),t.Q6J("ngTemplateOutlet",o),t.xp6(1),t.Q6J("ngIf",e.data.submitWithQrCodeScan),t.xp6(1),t.Q6J("ngIf",!e.data.submitWithQrCodeScan&&!1===t.lcZ(7,11,e.redirecting$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(9,13,e.redirecting$))}}function Ft(n,i){1&n&&t.GkF(0)}function Mt(n,i){if(1&n&&(t.ynx(0),t.YNc(1,Ft,1,0,"ng-container",12),t.BQk()),2&n){t.oxw(3);const e=t.MAs(11);t.xp6(1),t.Q6J("ngTemplateOutlet",e)}}function Pt(n,i){if(1&n&&(t._UZ(0,"div",16),t.ALo(1,"trust")),2&n){const e=t.oxw(3);t.Q6J("innerHTML",t.lcZ(1,1,e.result.content),t.oJD)}}function Lt(n,i){if(1&n&&(t.TgZ(0,"div",54),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.result.content,"")}}function Yt(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"action-button",20),t.NdJ("action",function(){const s=t.CHM(e).$implicit;return t.oxw(3).runPrimaryAction(s)}),t.ALo(2,"async"),t.qZA(),t.BQk()}if(2&n){const e=i.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",t.lcZ(2,2,o.requesting$))("label",e.action.label)}}function Dt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"action-button",55),t.NdJ("action",function(){return t.CHM(e),t.oxw(3).reload()}),t.ALo(1,"async"),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("disabled",t.lcZ(1,2,e.requesting$))("label",e.i18n.general.close)}}function Ut(n,i){if(1&n&&(t.TgZ(0,"page-content",48),t.ALo(1,"async"),t.YNc(2,Mt,2,1,"ng-container",1),t.ALo(3,"async"),t.YNc(4,Pt,2,3,"div",49),t.YNc(5,Lt,2,1,"div",50),t.TgZ(6,"actions",51),t.YNc(7,Yt,3,4,"ng-container",52),t.YNc(8,Dt,2,4,"action-button",53),t.qZA()()),2&n){const e=t.oxw(2);t.Q6J("heading",e.result.title||e.data.name)("headingActions",t.lcZ(1,8,e.headingActions$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(3,10,e.runDirectly$)),t.xp6(2),t.Q6J("ngIf","richText"===e.result.resultType&&e.result.content),t.xp6(1),t.Q6J("ngIf","plainText"===e.result.resultType&&e.result.content),t.xp6(1),t.Q6J("reverseRow",0==e.primaryActions.length),t.xp6(1),t.Q6J("ngForOf",e.primaryActions),t.xp6(1),t.Q6J("ngIf",e.showCloseButton)}}function $t(n,i){if(1&n&&(t.YNc(0,Ht,10,17,"page-content",34),t.ALo(1,"async"),t.ALo(2,"async"),t.YNc(3,Ut,9,12,"page-content",35),t.ALo(4,"async")),2&n){const e=t.oxw();t.Q6J("ngIf",e.data&&!t.lcZ(1,2,e.runDirectly$)&&null===t.lcZ(2,4,e.result$)),t.xp6(3),t.Q6J("ngIf",e.isContent&&t.lcZ(4,6,e.result$))}}function qt(n,i){1&n&&t.GkF(0)}function Bt(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"custom-field-input",58),t.BQk()),2&n){const e=i.$implicit,o=i.first,a=t.oxw(2);t.xp6(1),t.Q6J("field",e)("formControlName",e.internalName)("focused",!a.isSearch&&o)("submitAction",a.runAction)("labelPosition",a.isSearch?"left":"auto")}}function kt(n,i){if(1&n&&t._UZ(0,"file-field",59),2&n){const e=t.oxw(2);t.Q6J("label",e.i18n.operation.fileUpload)("formControl",e.fileControl)}}function Gt(n,i){if(1&n&&(t.ynx(0,56),t.YNc(1,qt,1,0,"ng-container",12),t.YNc(2,Bt,2,5,"ng-container",52),t.YNc(3,kt,1,2,"file-field",57),t.BQk()),2&n){const e=t.oxw(),o=t.MAs(11);t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("ngTemplateOutlet",o),t.xp6(1),t.Q6J("ngForOf",e.formFields),t.xp6(1),t.Q6J("ngIf",e.data.hasFileUpload)}}function jt(n,i){if(1&n&&(t.TgZ(0,"label-value",62)(1,"chip",63),t._uU(2),t.qZA()()),2&n){const e=t.oxw(2);t.Q6J("label",e.i18n.general.user),t.xp6(1),t.Q6J("image",e.data.user.image)("closeable",!1),t.xp6(1),t.hij(" ",e.data.user.display," ")}}function Xt(n,i){if(1&n&&(t.TgZ(0,"label-value",62)(1,"chip",63),t._uU(2),t.qZA()()),2&n){const e=t.oxw(2);t.Q6J("label",e.i18n.operation.ad),t.xp6(1),t.Q6J("image",e.data.ad.image)("closeable",!1),t.xp6(1),t.hij(" ",e.data.ad.name," ")}}function Wt(n,i){if(1&n&&(t.TgZ(0,"label-value",64),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("label",e.i18n.operation.transfer),t.xp6(1),t.hij(" ",e.data.transfer.display," ")}}function zt(n,i){if(1&n&&(t.TgZ(0,"label-value",64),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("label",e.data.recordType.name),t.xp6(1),t.hij(" ",e.data.record.display," ")}}function Vt(n,i){1&n&&t._UZ(0,"hr")}function Kt(n,i){if(1&n&&(t.YNc(0,jt,3,4,"label-value",60),t.YNc(1,Xt,3,4,"label-value",60),t.YNc(2,Wt,2,2,"label-value",61),t.YNc(3,zt,2,2,"label-value",61),t.YNc(4,Vt,1,0,"hr",1)),2&n){const e=t.oxw();t.Q6J("ngIf",e.data.user&&e.data.user.id!==e.login.user.id),t.xp6(1),t.Q6J("ngIf",e.data.ad),t.xp6(1),t.Q6J("ngIf",e.data.transfer),t.xp6(1),t.Q6J("ngIf",e.data.record&&e.data.recordType),t.xp6(1),t.Q6J("ngIf",e.data.user&&e.data.user.id!==e.login.user.id||e.data.ad||e.data.transfer||e.data.record)}}let _=(()=>{class n extends C.y{constructor(e,o,a,s,c,p,g){super(e),this.fieldsHelper=o,this.operationHelper=a,this.runOperationHelper=s,this.nextRequestState=c,this.operationsService=p,this.modal=g,this.result$=new R.X(null),this.pageResults$=new R.X(null),this.redirecting$=new R.X(!1),this.canRunDirectly=!0,this.runDirectly$=new R.X(!1)}get result(){return this.result$.value}get pageResults(){return this.pageResults$.value}ngOnInit(){super.ngOnInit();const e=this.route.snapshot;if(this.runScope=e.data.runScope,this.userParam=e.params.user,this.clearCloseTimer(),!this.runScope)throw new Error(`No runScope on ${e.url}`);const o={operation:e.params.operation};let a;switch(this.createDeviceConfirmation=()=>({type:L.l.RUN_OPERATION,operation:this.data.id}),this.runScope){case l.User:this.scopeId=o.owner=e.params.user||this.login.user.id,a=this.operationsService.getOwnerOperationDataForRun(o);break;case l.Ad:this.scopeId=o.ad=e.params.ad,a=this.operationsService.getAdOperationDataForRun(o);break;case l.Record:this.scopeId=o.id=e.params.record,a=this.operationsService.getRecordOperationDataForRun(o);break;case l.Transfer:this.scopeId=o.key=e.params.transfer,a=this.operationsService.getTransferOperationDataForRun(o);break;case l.Menu:this.scopeId=o.menu=e.params.menu,a=this.operationsService.getMenuOperationDataForRun(o);break;default:a=this.operationsService.getOperationDataForRun(o)}this.nextRequestState.queryParams=e.queryParams,this.leaveNotification=this.nextRequestState.leaveNotification,this.handleReRunAndGetOperationData(a)}onDataInitialized(e){if(this.alreadyExecuted)return;this.stateManager.set(n.OPERATION_DATA,e),this.runScope===l.User&&(this.self=this.authHelper.isSelf(e.user)),this.isSearch=e.resultType===O.X.RESULT_PAGE,this.isContent=[O.X.PLAIN_TEXT,O.X.RICH_TEXT].includes(e.resultType);const o=e.formParameters||[];this.form=this.fieldsHelper.customValuesFormGroup(o,{disabledProvider:s=>s.readonly}),this.fileControl=this.formBuilder.control(null);const a=this.runOperationHelper.canRunDirectly(e,!1);if(this.showCloseButton=!a,this.runDirectly$.next(this.canRunDirectly&&a),this.hasSearchFields=o.length>0||e.hasFileUpload,o.length>0){const s=this.route.snapshot.queryParamMap;this.formFields=[];for(const c of o){const p=s.get(c.internalName);if((0,A.cS)(p))c.readonly&&!this.form.controls[c.internalName].value?this.form.removeControl(c.internalName):this.formFields.push(c);else{const g={};g[c.internalName]=p,this.form.patchValue(g,{emitEvent:!1})}}}this.isSearch?this.pageData={page:0,pageSize:this.uiLayout.searchPageSize}:this.startNewOperation&&this.stateManager.stopManaging(),this.stateManager.manage(this.form),this.operationHelper.register(e.rowOperation),this.addHeadingActions(e,e.actions),this.runDirectly$.value&&(this.nextRequestState.leaveNotification=this.leaveNotification,this.isSearch&&this.addSub(this.form.valueChanges.pipe((0,U.b)(T.S.DEBOUNCE_TIME)).subscribe(()=>{this.pageData.page=0,this.run(e)})),this.startNewOperation&&this.run(e)),this.reRun&&this.run(e)}handleReRunAndGetOperationData(e){const o=this.stateManager.get(n.OPERATION_DATA);if(this.alreadyExecuted=!!this.route.snapshot.data.action&&!this.runOperationHelper.allowActionExecution&&!o,this.runOperationHelper.allowActionExecution=!1,this.runOperationHelper.reRun||this.runOperationHelper.startNewOperation||!o||o.reRun)this.reRun=this.runOperationHelper.reRun||(null==o?void 0:o.reRun),this.startNewOperation=!this.reRun,this.runOperationHelper.alreadyConfirmedSession=!1,this.runOperationHelper.reRun=!1,this.runOperationHelper.startNewOperation=!1,this.cleanCache(),this.addSub(e.subscribe(a=>this.data=a));else{this.reRun=!1,this.startNewOperation=!1;let a=this.getResultResponseFromStateManager();this.canRunDirectly=!!a,this.data=o,a&&this.afterRun(a)}}ngOnDestroy(){this.clearCloseTimer()}clearCloseTimer(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}cleanCache(){this.stateManager.delete(n.OPERATION_DATA),this.stateManager.delete(n.OPERATION_RESULT_RESPONSE),this.stateManager.delete(n.OPERATION_RESULT_RESPONSE_HEADERS)}getResultResponseFromStateManager(){let e=this.stateManager.get(n.OPERATION_RESULT_RESPONSE);if(!e)return null;let o=new P.WM;const a=this.stateManager.get(n.OPERATION_RESULT_RESPONSE_HEADERS);return null==a||a.forEach((s,c)=>o=o.set(c,s)),e=e.clone({headers:o}),e}run(e){!e&&!(e=this.data)||!(0,A.pt)(this.form)||(e.submitWithQrCodeScan?this.modal.show(D.u,{class:"modal-form"}).content.select.pipe((0,Q.P)()).subscribe(s=>this.confirmAndRun(e,s)):this.confirmAndRun(e))}confirmAndRun(e,o){var a;if(!(0,A.cS)(e.confirmationText)||e.confirmationPasswordInput){const s=null===(a=e.confirmationPasswordInput)||void 0===a?void 0:a.confirmationPasswordOncePerSession;this.confirmation.confirm({title:e.name,message:e.confirmationText,createDeviceConfirmation:this.createDeviceConfirmation,passwordInput:s&&this.runOperationHelper.alreadyConfirmedSession?null:e.confirmationPasswordInput,callback:c=>this.doRun(e,{confirmationPassword:c.confirmationPassword,scannedQrCode:o}),cancelCallback:()=>this.runDirectly$.next(!1)})}else this.doRun(e,{scannedQrCode:o})}updatePage(e){this.pageData=e,this.run()}get runAction(){return()=>this.run()}doRun(e,o){const a=this.runOperationHelper.runRequest(e,{scopeId:this.scopeId,confirmationPassword:(o=o||{}).confirmationPassword,scannedQrCode:o.scannedQrCode,formParameters:this.form.value,exportFormat:o.exportFormat,pageData:this.pageData,upload:this.fileControl.value});this.nextRequestState.queryParams=this.route.snapshot.queryParams,this.addSub(a.pipe((0,Q.P)(),(0,$.b)(c=>c,()=>this.redirecting$.next(!1))).subscribe(c=>{e.requireConfirmationPassword&&(this.runOperationHelper.alreadyConfirmedSession=!0),this.afterRun(c)})),this.redirecting$.next(e.resultType===O.X.EXTERNAL_REDIRECT)}setResultResponseInCache(e){this.stateManager.set(n.OPERATION_RESULT_RESPONSE,e);let o=new Map;e.headers.keys().every(a=>o.set(a,e.headers.get(a))),this.stateManager.set(n.OPERATION_RESULT_RESPONSE_HEADERS,o)}afterRun(e){if(this.setResultResponseInCache(e),this.confirmation.hide(),this.runOperationHelper.handleResult(e))return;const a=e.body;if(this.result$.next(a),this.isContent&&null!=this.data.closeAfterSeconds&&(this.closeTimer=setTimeout(()=>this.reload(),1e3*this.data.closeAfterSeconds)),this.addHeadingActions(this.data,a.actions),this.isSearch){const s=new J.x(a.rows);J.x.fillHeaders(s,e),this.pageResults$.next(s)}}reload(){this.clearCloseTimer(),this.runOperationHelper.startNewOperation=!0,super.reload()}addHeadingActions(e,o){const a=[];e.allowPrint&&this.isContent?a.push(this.exportHelper.printAction()):(0,A.cS)(e.exportFormats)||this.exportHelper.headingActions(e.exportFormats,s=>this.runOperationHelper.runRequest(e,{scopeId:this.scopeId,formParameters:this.form.value,pageData:this.pageData,upload:this.fileControl.value,exportFormat:s})).forEach(s=>a.push(s)),this.primaryActions=[];for(const s of o||[]){const c=s.action;c&&(s.primary?this.primaryActions.push(s):(this.operationHelper.register(c),a.push(new Y.Yu(this.operationHelper.icon(c),c.label,()=>{this.runOperationHelper.startNewOperation=!0,this.runOperationHelper.allowActionExecution=!0,this.runOperationHelper.run(c,null,s.parameters)}))))}1===a.length&&(a[0].maybeRoot=!0),this.headingActions=a}runPrimaryAction(e){this.runOperationHelper.startNewOperation=!0,this.runOperationHelper.allowActionExecution=!0,this.runOperationHelper.run(e.action,null,e.parameters)}rowClick(e){const o=this.data,a=o.rowAction,s={};switch((o.rowParameters||[]).forEach(c=>s[c]=e[c]),a){case h.OPERATION:this.runOperationHelper.startNewOperation=!0;const c=o.rowOperation;this.runOperationHelper.allowActionExecution=!0,this.router.navigate(["/operations","action",T.S.internalNameOrId(c)],{queryParams:s});break;case h.URL:let p=o.rowUrl;for(const w of Object.keys(s)){const H=s[w];H&&(p+=p.includes("?")?"&":"?",p+=encodeURIComponent(w)+"="+encodeURIComponent(H))}window.open(p);break;case h.LOCATION:const g=T.S.urlForLocation(o.rowLocation,s.id);g&&this.router.navigateByUrl(g)}}get onClick(){return e=>this.rowClick(e)}formatCell(e,o){switch(o.type){case m.BOOLEAN:return this.format.formatBoolean(e);case m.DATE:return this.format.formatAsDate(e);case m.NUMBER:return this.format.formatAsNumber(e,o.decimalDigits);case m.CURRENCY_AMOUNT:if(e&&"object"==typeof e)return this.format.formatAsCurrency(e.currency,e.amount)}return String(e)}resolveMenu(e){if(e.scope===I.h.SYSTEM||e.scope===I.h.USER&&this.self)return new d.oX(this.menu.menuForOwnerOperation(e),{operation:e});switch(this.runScope){case l.User:return this.menu.userMenu(e.user,d.v2.MY_PROFILE);case l.Ad:return this.menu.userMenu(e.user,d.v2.SEARCH_ADS);case l.Record:return this.authHelper.isSelf(e.user)?this.menu.menuForRecordType(e.user,e.recordType):this.menu.userMenu(e.user,d.v2.SEARCH_USERS);case l.Transfer:return this.menu.transferMenu(e.transfer);case l.Menu:const o=this.menu.contentPageEntry(T.S.internalNameOrId(e.menuItem));return null==o?void 0:o.activeMenu;case l.Standalone:return null}}}return n.OPERATION_DATA="operationData",n.OPERATION_RESULT_RESPONSE="operationResultResponse",n.OPERATION_RESULT_RESPONSE_HEADERS="operationResultResponseHeaders",n.\u0275fac=function(e){return new(e||n)(t.Y36(t.zs3),t.Y36(q.A),t.Y36(B.p),t.Y36(k.Y),t.Y36(G.AM),t.Y36(S.$),t.Y36(j.tT))},n.\u0275cmp=t.Xpm({type:n,selectors:[["run-operation"]],features:[t.qOj],decls:12,vars:6,consts:[[3,"ready"],[4,"ngIf"],[4,"ngIf","ngIfThen"],["content",""],["regular",""],["theForm",""],["operationContext",""],["type","danger",1,"mt-3"],[4,"ngIf","ngIfElse"],[3,"mode","heading","mobileHeading","headingActions"],["type","info","class","mt-3",4,"ngIf"],[1,"filters-form","filters-form-separator",3,"formGroup"],[4,"ngTemplateOutlet"],["kind","secondary","class","mb-3 mt-0",4,"ngIf"],["resultType","list",3,"results","onClick","update",4,"ngIf"],["type","info",1,"mt-3"],[3,"innerHTML"],["kind","secondary",1,"mb-3","mt-0"],[3,"disabled","label","action",4,"ngIf"],[3,"label","action",4,"ngFor","ngForOf"],[3,"disabled","label","action"],[3,"label","action"],["resultType","list",3,"results","onClick","update"],[4,"mobileResult"],["class","table table-hover",3,"ngClass",4,"resultTable"],["labelPosition","sideForced","valueFormat","html",3,"label","value",4,"ngFor","ngForOf"],["labelPosition","sideForced","valueFormat","html",3,"label","value"],[1,"table","table-hover",3,"ngClass"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"click",4,"ngFor","ngForOf"],[3,"ngStyle"],[3,"click"],[3,"ngStyle","innerHTML",4,"ngFor","ngForOf"],[3,"ngStyle","innerHTML"],["last","",3,"heading","mobileHeading","headingActions",4,"ngIf"],["last","",3,"heading","headingActions",4,"ngIf"],["last","",3,"heading","mobileHeading","headingActions"],["type","info",4,"ngIf"],[3,"ngClass"],["class","operation-qr-code-scan",4,"ngIf"],["class","mt-3 text-right",4,"ngIf"],["type","info"],[1,"operation-qr-code-scan"],["type","button",1,"btn","btn-icon","operation-qr-code-scan-button",3,"click"],[3,"icon"],["class","operation-qr-code-scan-label",4,"ngIf"],[1,"operation-qr-code-scan-label"],[1,"mt-3","text-right"],["last","",3,"heading","headingActions"],[3,"innerHTML",4,"ngIf"],["class","break-nl",4,"ngIf"],[3,"reverseRow"],[4,"ngFor","ngForOf"],["outline","",3,"disabled","label","action",4,"ngIf"],[1,"break-nl"],["outline","",3,"disabled","label","action"],[3,"formGroup"],[3,"label","formControl",4,"ngIf"],[3,"field","formControlName","focused","submitAction","labelPosition"],[3,"label","formControl"],["kind","field",3,"label",4,"ngIf"],["kind","fieldView",3,"label",4,"ngIf"],["kind","field",3,"label"],[3,"image","closeable"],["kind","fieldView",3,"label"]],template:function(e,o){if(1&e&&(t.TgZ(0,"page-layout",0),t.ALo(1,"async"),t.YNc(2,ct,3,1,"ng-container",1),t.YNc(3,lt,1,0,"ng-container",2),t.qZA(),t.YNc(4,Ct,1,2,"ng-template",null,3,t.W1O),t.YNc(6,$t,5,8,"ng-template",null,4,t.W1O),t.YNc(8,Gt,4,4,"ng-template",null,5,t.W1O),t.YNc(10,Kt,5,5,"ng-template",null,6,t.W1O)),2&e){const a=t.MAs(5);t.Q6J("ready",t.lcZ(1,4,o.data$)),t.xp6(2),t.Q6J("ngIf",o.alreadyExecuted),t.xp6(1),t.Q6J("ngIf",o.data&&!o.alreadyExecuted)("ngIfThen",a)}},directives:[N.w,u.O5,E.wx,Z.Y,x.JL,x.sg,u.tP,X.h,W.x,u.sg,z.D,V.E,K.t,tt.t,et.p,u.mk,u.PC,nt.o,ot.G,x.JJ,x.u,at.A,it.O,x.oH,rt.Y],pipes:[u.Ov,st.a],encapsulation:2,changeDetection:0}),n})();const te=[{path:"",children:[{path:"system/:operation",component:_,canActivate:[f.b],data:{runScope:l.Standalone}},{path:"self/:operation",component:_,canActivate:[f.b],data:{runScope:l.User}},{path:"action/:operation",component:_,data:{action:!0,runScope:l.Standalone}},{path:"user/:user/:operation",component:_,canActivate:[f.b],data:{runScope:l.User}},{path:"marketplace/:ad/:operation",component:_,canActivate:[f.b],data:{runScope:l.Ad}},{path:"record/:record/:operation",component:_,canActivate:[f.b],data:{runScope:l.Record}},{path:"transfer/:transfer/:operation",component:_,canActivate:[f.b],data:{runScope:l.Transfer}},{path:"menu/:menu/:operation",component:_,data:{runScope:l.Menu}},{path:"callback/:id/:token",component:M}]}];let ee=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[y.Bz.forChild(te)],y.Bz]}),n})();var ne=r(4443);let oe=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[ee,ne.C]]}),n})()}}]);